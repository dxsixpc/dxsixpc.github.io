(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{582:function(s,n,a){"use strict";a.r(n);var e=a(4),t=Object(e.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"目录"}},[s._v("目录")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("函数的 5 种声明")])]),s._v(" "),a("li",[a("p",[s._v("如何调用函数 f.call")])]),s._v(" "),a("li",[a("p",[s._v("this 和 arguments")])]),s._v(" "),a("li",[a("p",[s._v("什么是 call stack")])]),s._v(" "),a("li",[a("p",[s._v("作用域")])]),s._v(" "),a("li",[a("p",[s._v("闭包")])])]),s._v(" "),a("h2",{attrs:{id:"函数的-5-种声明"}},[s._v("函数的 5 种声明")]),s._v(" "),a("ol",[a("li",[s._v("具名函数")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("function f(x,y){\n  return x+y\n}\nf.name // 'f'\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("匿名函数")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("var f\nf = function(x, y){\n\treturn x+y\n}\nf.name //'f'\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("具名函数赋值")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("var f\nf = function f2(x,y){ return x+y }\nf.name // 'f2'\nconsole.log(f2) // undefined\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ol",{attrs:{start:"4"}},[a("li",[s._v("Window.Function")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("window.Function\nvar f = new Function('x','y','return x+y')\nf.name // \"anonymous\"\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ol",{attrs:{start:"5"}},[a("li",[s._v("箭头函数")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("var f = (x,y) => {\n  return x+y\n}\n\nvar sum = (x,y) => x+y\n\nvar n2 = n => n*n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h2",{attrs:{id:"如何调用函数"}},[s._v("如何调用函数")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("f.call(asThis, input1,input2)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("其中 "),a("code",[s._v("asThis")]),s._v(" 会被当做 "),a("code",[s._v("this")]),s._v("，"),a("code",[s._v("[input1,input2]")]),s._v(" 会被当做 "),a("code",[s._v("arguments")])]),s._v(" "),a("p",[s._v("禁止使用 "),a("code",[s._v("f(input1, input2)")])]),s._v(" "),a("h2",{attrs:{id:"this-和-arguments"}},[s._v("this 和 arguments")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("function f(){\n    'use strict'\n    console.log(this)\n    console.log(arguments)\n    return undefined\n}\nf.call(1,2,3) // this 为 1，arguments 为 [2,3]\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h2",{attrs:{id:"什么是-call-stack"}},[s._v("什么是 call stack")]),s._v(" "),a("p",[s._v("· "),a("a",{attrs:{href:"http://latentflip.com/loupe/?code=ZnVuY3Rpb24gYSgpewogICAgY29uc29sZS5sb2coJ2EnKQogIHJldHVybiAnYScgIAp9CgpmdW5jdGlvbiBiKCl7CiAgICBjb25zb2xlLmxvZygnYicpCiAgICByZXR1cm4gJ2InCn0KCmZ1bmN0aW9uIGMoKXsKICAgIGNvbnNvbGUubG9nKCdjJykKICAgIHJldHVybiAnYycKfQoKYS5jYWxsKCkKYi5jYWxsKCkKYy5jYWxsKCk%3D!!!",target:"_blank",rel:"noopener noreferrer"}},[s._v("普通调用"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("· "),a("a",{attrs:{href:"http://latentflip.com/loupe/?code=ZnVuY3Rpb24gYSgpewogICAgY29uc29sZS5sb2coJ2ExJykKICAgIGIuY2FsbCgpCiAgICBjb25zb2xlLmxvZygnYTInKQogIHJldHVybiAnYScgIAp9CmZ1bmN0aW9uIGIoKXsKICAgIGNvbnNvbGUubG9nKCdiMScpCiAgICBjLmNhbGwoKQogICAgY29uc29sZS5sb2coJ2IyJykKICAgIHJldHVybiAnYicKfQpmdW5jdGlvbiBjKCl7CiAgICBjb25zb2xlLmxvZygnYycpCiAgICByZXR1cm4gJ2MnCn0KYS5jYWxsKCkKY29uc29sZS5sb2coJ2VuZCcp!!!",target:"_blank",rel:"noopener noreferrer"}},[s._v("嵌套调用"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("· "),a("a",{attrs:{href:"http://latentflip.com/loupe/?code=ZnVuY3Rpb24gc3VtKG4pewogICAgaWYobj09MSl7CiAgICAgICAgcmV0dXJuIDEKICAgIH1lbHNlewogICAgICAgIHJldHVybiBuICsgc3VtLmNhbGwodW5kZWZpbmVkLCBuLTEpCiAgICB9Cn0KCnN1bS5jYWxsKHVuZGVmaW5lZCw1KQ%3D%3D!!!PGJ1dHRvbj5DbGljayBtZSE8L2J1dHRvbj4%3D",target:"_blank",rel:"noopener noreferrer"}},[s._v("递归调用"),a("OutboundLink")],1)]),s._v(" "),a("h2",{attrs:{id:"作用域"}},[s._v("作用域")]),s._v(" "),a("p",[s._v("按照语法树，就近原则。")]),s._v(" "),a("p",[s._v("我们只能确定变量是哪个变量，但是不能确定变量的值")]),s._v(" "),a("p",[s._v("面试题1")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("var a = 1\n\nfunction f1(){\n  alert(a) // 是多少\n  var a = 2\n}\n\nf1.call()\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("面试题2")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("var a = 1\n\nfunction f1(){\n  var a = 2\n  f2.call()\n\n}\n\nfunction f2(){\n  console.log(a) // 是多少\n}\nf1.call()\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("面试题3")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("var liTags = document.querySelectorAll('li')\n\nfor(var i = 0; i<liTags.length; i++){\n  liTags[i].onclick = function(){\n    console.log(i) // 点击第3个 li 时，打印 2 还是打印 6？\n  }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h2",{attrs:{id:"闭包"}},[s._v("闭包")]),s._v(" "),a("ol",[a("li",[s._v("什么是「闭包」。")]),s._v(" "),a("li",[s._v("「闭包」的作用是什么。")])]),s._v(" "),a("h3",{attrs:{id:"什么是闭包"}},[s._v("什么是闭包")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("var local = '变量'\n\nfunction foo() {\n\tconsole.log(local)\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("上面三行代码在一个立即执行函数中。")]),s._v(" "),a("p",[s._v("三行代码中，有一个局部变量 local，有一个函数 foo，foo 里面可以访问到 local 变量。")]),s._v(" "),a("p",[s._v("好了这就是一个闭包：")]),s._v(" "),a("blockquote",[a("p",[s._v("「函数」和「函数内部能访问到的变量」（也叫环境）的总和，就是一个闭包。")])]),s._v(" "),a("p",[s._v("「我听说闭包是需要函数套函数，然后 return 一个函数的呀！」")]),s._v(" "),a("p",[s._v("比如这样：")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("function foo(){\n  var local = 1\n  function bar(){\n    local++\n    return local\n  }\n  return bar\n}\n\nvar func = foo()\nfunc()\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("这里面确实有闭包，local 变量和 bar 函数就组成了一个闭包（Closure）。")]),s._v(" "),a("p",[a("strong",[s._v("为什么要函数套函数呢？")])]),s._v(" "),a("p",[s._v("是因为需要局部变量，所以才把 local 放在一个函数里，如果不把 local 放在一个函数里，local 就是一个全局变量了，达不到使用闭包的目的——隐藏变量（等会会讲）。")]),s._v(" "),a("p",[s._v("这也是为什么我上面要说「运行在一个立即执行函数中」。")]),s._v(" "),a("p",[s._v("有些人看到「闭包」这个名字，就一定觉得要用什么包起来才行。其实这是翻译问题，闭包的原文是 Closure，跟「包」没有任何关系。")]),s._v(" "),a("p",[s._v("所以函数套函数只是为了造出一个局部变量，跟闭包无关。")]),s._v(" "),a("p",[a("strong",[s._v("为什么要 return bar 呢？")])]),s._v(" "),a("p",[s._v("因为如果不 return，你就无法使用这个闭包。把 return bar 改成 window.bar = bar 也是一样的，只要让外面可以访问到这个 bar 函数就行了。")]),s._v(" "),a("p",[s._v("所以 return bar 只是为了 bar 能被使用，也跟闭包无关。")]),s._v(" "),a("h3",{attrs:{id:"闭包的作用"}},[s._v("闭包的作用")]),s._v(" "),a("p",[s._v("闭包常常用来「间接访问一个变量」。换句话说，「隐藏一个变量」。")]),s._v(" "),a("p",[s._v("假设我们在做一个游戏，在写其中关于「还剩几条命」的代码。")]),s._v(" "),a("p",[s._v("如果不用闭包，你可以直接用一个全局变量：")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("window.lives = 30 // 还有三十条命\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("这样看起来很不妥。万一不小心把这个值改成 -1 了怎么办。所以我们不能让别人「直接访问」这个变量。怎么办呢？")]),s._v(" "),a("p",[s._v("用局部变量。")]),s._v(" "),a("p",[s._v("但是用局部变量别人又访问不到，怎么办呢？")]),s._v(" "),a("p",[s._v("暴露一个访问器（函数），让别人可以「间接访问」。")]),s._v(" "),a("p",[s._v("代码如下：")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("!function(){\n\n  var lives = 50\n\n  window.奖励一条命 = function(){\n    lives += 1\n  }\n\n  window.死一条命 = function(){\n    lives -= 1\n  }\n\n}()\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("简明起见，我用了中文 😃")]),s._v(" "),a("p",[s._v("那么在其他的 JS 文件，就可以使用 window.奖励一条命() 来涨命，使用 window.死一条命() 来让角色掉一条命。")]),s._v(" "),a("p",[a("strong",[s._v("所谓闭包的作用")])]),s._v(" "),a("p",[s._v("如果我们在写代码时，根本就不知道闭包，只是按照自己的意图写，最后，发现满足了闭包的定义。")]),s._v(" "),a("p",[s._v("那么请问，这算是闭包的作用吗？")]),s._v(" "),a("p",[s._v("这个问题，留给你思考。")]),s._v(" "),a("p",[a("strong",[s._v("闭包谣言")])]),s._v(" "),a("p",[s._v("闭包会造成内存泄露？")]),s._v(" "),a("p",[s._v("错。")]),s._v(" "),a("p",[s._v("说这话的人根本不知道什么是内存泄露。内存泄露是指你用不到（访问不到）的变量，依然占居着内存空间，不能被再次利用起来。")]),s._v(" "),a("p",[s._v("闭包里面的变量明明就是我们需要的变量（lives），凭什么说是内存泄露？")]),s._v(" "),a("p",[s._v("这个谣言是如何来的？")]),s._v(" "),a("p",[s._v("因为 IE。IE 有 bug，IE 在我们使用完闭包之后，依然回收不了闭包里面引用的变量。")]),s._v(" "),a("p",[s._v("这是 IE 的问题，不是闭包的问题。参见司徒正美的"),a("a",{attrs:{href:"https://link.zhihu.com/?target=http%3A//www.cnblogs.com/rubylouvre/p/3345294.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("这篇文章"),a("OutboundLink")],1),s._v("。")])])}),[],!1,null,null,null);n.default=t.exports}}]);